<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RailOptima - AI Enhanced Train Traffic Control System</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #2c3e50;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .header h1 {
      color: #2c3e50;
      font-size: 28px;
      font-weight: 700;
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
    }

    .status-dot {
      width: 12px;
      height: 12px;
      background: #10b981;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .main-content {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
    }

    .track-section {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .section-title {
      font-size: 20px;
      font-weight: 600;
      color: #2c3e50;
    }

    #viewMode {
      padding: 8px 15px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      background: white;
      font-weight: 500;
    }

    .track-visualization {
      position: relative;
      height: 400px;
      background: linear-gradient(to bottom, #e0f2fe 0%, #b3e5fc 100%);
      border-radius: 10px;
      overflow: hidden;
      border: 2px solid #0277bd;
    }

    .track-line {
      position: absolute;
      height: 6px;
      background: #374151;
      border-radius: 3px;
      left: 5%;
      right: 5%;
      top: 50%;
      transform: translateY(-50%);
      z-index: 1;
    }

    .track-line.secondary {
      top: 60%;
      background: #6b7280;
      height: 4px;
    }

    .track-junction {
      position: absolute;
      width: 40px;
      height: 40px;
      background: #374151;
      border-radius: 50%;
      z-index: 10;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 12px;
    }

    .track-junction:hover {
      background: #4f46e5;
      transform: scale(1.1);
    }

    .track-junction.active {
      background: #10b981;
      box-shadow: 0 0 20px rgba(16, 185, 129, 0.5);
    }

    .station {
      position: absolute;
      background: linear-gradient(135deg, #3b82f6, #1e40af);
      color: white;
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
      text-align: center;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
      z-index: 5;
    }

    .train {
      position: absolute;
      width: 40px;
      height: 20px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: bold;
      color: white;
      cursor: pointer;
      transition: all 0.3s;
      z-index: 10;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .train.express {
      background: linear-gradient(90deg, #ef4444, #dc2626);
    }

    .train.passenger {
      background: linear-gradient(90deg, #3b82f6, #2563eb);
    }

    .train.freight {
      background: linear-gradient(90deg, #6b7280, #4b5563);
    }

    .train:hover {
      transform: scale(1.1);
    }

    .train.selected {
      box-shadow: 0 0 20px rgba(59, 130, 246, 0.8);
      transform: scale(1.15);
    }

    .control-panel {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .ai-control-panel {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 10px;
      padding: 15px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .ai-control-panel h3 {
      margin-bottom: 15px;
      color: #2c3e50;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .ai-indicator {
      width: 10px;
      height: 10px;
      background: #10b981;
      border-radius: 50%;
      animation: pulse 1s infinite;
    }

    .ai-indicator.thinking {
      background: #f59e0b;
    }

    .btn-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 15px;
    }

    .btn {
      padding: 10px 15px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 14px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      color: white;
    }

    .btn-success {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
    }

    .btn-warning {
      background: linear-gradient(135deg, #f59e0b, #ef4444);
      color: white;
    }

    .btn-secondary {
      background: #e5e7eb;
      color: #374151;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .metrics-panel {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 10px;
      padding: 15px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .metric-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid #e5e7eb;
    }

    .metric-item:last-child {
      border-bottom: none;
    }

    .metric-label {
      font-size: 14px;
      color: #6b7280;
    }

    .metric-value {
      font-size: 18px;
      font-weight: bold;
      color: #2c3e50;
    }

    .metric-value.good { color: #10b981; }
    .metric-value.warning { color: #f59e0b; }
    .metric-value.bad { color: #ef4444; }

    .train-list {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 10px;
      padding: 15px;
      max-height: 300px;
      overflow-y: auto;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .train-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      margin-bottom: 10px;
      background: #f3f4f6;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .train-item:hover {
      background: #e5e7eb;
      transform: translateX(5px);
    }

    .train-info {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .train-id {
      font-weight: 600;
      color: #2c3e50;
    }

    .train-status {
      font-size: 12px;
      color: #6b7280;
    }

    .priority-badge {
      padding: 4px 8px;
      border-radius: 5px;
      font-size: 11px;
      font-weight: 600;
      color: white;
    }

    .priority-high { background: #ef4444; }
    .priority-medium { background: #f59e0b; }
    .priority-low { background: #10b981; }

    .optimization-result {
      background: linear-gradient(135deg, #d1fae5, #a7f3d0);
      border: 2px solid #10b981;
      border-radius: 10px;
      padding: 15px;
      margin-top: 20px;
      display: none;
    }

    .optimization-result.show {
      display: block;
      animation: slideIn 0.5s ease;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .result-header {
      font-weight: 600;
      color: #065f46;
      margin-bottom: 10px;
    }

    .result-item {
      font-size: 14px;
      color: #064e3b;
      margin: 5px 0;
    }

    .signal {
      position: absolute;
      width: 20px;
      height: 40px;
      background: #374151;
      border-radius: 5px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-around;
      padding: 5px;
      z-index: 5;
    }

    .signal-light {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #9ca3af;
    }

    .signal-light.red {
      background: #ef4444;
      box-shadow: 0 0 10px #ef4444;
    }

    .signal-light.yellow {
      background: #f59e0b;
      box-shadow: 0 0 10px #f59e0b;
    }

    .signal-light.green {
      background: #10b981;
      box-shadow: 0 0 10px #10b981;
    }

    .ai-decision-log {
      background: #f8fafc;
      border-radius: 8px;
      padding: 12px;
      margin-top: 10px;
      max-height: 150px;
      overflow-y: auto;
      border-left: 4px solid #3b82f6;
    }

    .ai-log-item {
      font-size: 12px;
      color: #475569;
      margin: 5px 0;
      padding: 5px;
      background: white;
      border-radius: 4px;
    }

    .ai-log-timestamp {
      color: #64748b;
      font-weight: 500;
    }

    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .loading-overlay.show { display: flex; }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 6px solid #f3f4f6;
      border-top: 6px solid #3b82f6;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .alert {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      display: none;
      z-index: 2000;
      animation: slideInRight 0.5s ease;
    }

    .alert.show { display: block; }

    @keyframes slideInRight {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    .alert.success { border-left: 4px solid #10b981; }
    .alert.warning { border-left: 4px solid #f59e0b; }
    .alert.error { border-left: 4px solid #ef4444; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ðŸš‚ RailOptima - AI Enhanced Train Traffic Control System</h1>
      <div class="status-indicator">
        <div class="status-dot"></div>
        <span>AI System Active</span>
      </div>
    </div>

    <div class="main-content">
      <!-- Track Section -->
      <div class="track-section">
        <div class="section-header">
          <h2 class="section-title">Section: Mumbai Central - Borivali</h2>
          <select id="viewMode">
            <option value="normal">Normal View</option>
            <option value="optimized">Optimized View</option>
          </select>
        </div>

        <div class="track-visualization" id="trackViz">
          <!-- Main Track Line -->
          <div class="track-line main-track"></div>
          <!-- Secondary Track Line -->
          <div class="track-line secondary"></div>

          <!-- Track Junctions -->
          <div class="track-junction" id="junction1" style="left: 25%; top: 45%;" onclick="toggleJunction('junction1')">J1</div>
          <div class="track-junction" id="junction2" style="left: 50%; top: 45%;" onclick="toggleJunction('junction2')">J2</div>
          <div class="track-junction" id="junction3" style="left: 75%; top: 45%;" onclick="toggleJunction('junction3')">J3</div>

          <!-- Stations -->
          <div class="station" style="left: 5%; top: 35%;">Mumbai<br>Central</div>
          <div class="station" style="left: 30%; top: 35%;">Dadar</div>
          <div class="station" style="left: 55%; top: 35%;">Bandra</div>
          <div class="station" style="left: 80%; top: 35%;">Borivali</div>

          <!-- Signals -->
          <div class="signal" style="left: 20%; top: 42%;">
            <div class="signal-light red" id="signal1"></div>
            <div class="signal-light"></div>
            <div class="signal-light"></div>
          </div>
          <div class="signal" style="left: 45%; top: 42%;">
            <div class="signal-light"></div>
            <div class="signal-light yellow" id="signal2"></div>
            <div class="signal-light"></div>
          </div>
          <div class="signal" style="left: 70%; top: 42%;">
            <div class="signal-light"></div>
            <div class="signal-light"></div>
            <div class="signal-light green" id="signal3"></div>
          </div>
        </div>

        <!-- Optimization Result -->
        <div class="optimization-result" id="optimizationResult">
          <div class="result-header">âœ… AI Optimization Complete!</div>
          <div class="result-item">â€¢ Reduced average delay by <strong>35%</strong></div>
          <div class="result-item">â€¢ Improved throughput by <strong>28%</strong></div>
          <div class="result-item">â€¢ Resolved <strong>3 conflicts</strong></div>
          <div class="result-item">â€¢ Optimized 2 track changes automatically</div>
        </div>
      </div>

      <!-- Control Panel -->
      <div class="control-panel">
        <!-- AI Control Panel -->
        <div class="ai-control-panel">
          <h3>ðŸ¤– AI Track Management <div class="ai-indicator" id="aiIndicator"></div></h3>
          
          <div class="btn-group">
            <button class="btn btn-primary" onclick="enableAIMode()">ðŸ§  Enable AI Mode</button>
            <button class="btn btn-success" onclick="runAIOptimization()">ðŸš€ AI Optimize</button>
            <button class="btn btn-warning" onclick="emergencyOverride()">âš¡ Emergency Override</button>
            <button class="btn btn-secondary" onclick="manualMode()">ðŸ‘¤ Manual Mode</button>
          </div>

          <div class="ai-decision-log" id="aiDecisionLog">
            <div class="ai-log-item">
              <span class="ai-log-timestamp">[00:00:00]</span> AI System initialized
            </div>
          </div>
        </div>

        <div class="metrics-panel">
          <h3>Real-Time Metrics</h3>
          <div class="metric-item"><span class="metric-label">Active Trains</span><span class="metric-value" id="activeTrains">5</span></div>
          <div class="metric-item"><span class="metric-label">Avg Delay</span><span class="metric-value warning" id="avgDelay">12 min</span></div>
          <div class="metric-item"><span class="metric-label">Throughput</span><span class="metric-value good" id="throughput">85%</span></div>
          <div class="metric-item"><span class="metric-label">Conflicts</span><span class="metric-value bad" id="conflicts">2</span></div>
          <div class="metric-item"><span class="metric-label">AI Decisions</span><span class="metric-value good" id="aiDecisions">0</span></div>
        </div>

        <div class="train-list">
          <h3>Train Schedule</h3>
          <div class="train-item" onclick="selectTrain('EXP-001')">
            <div class="train-info">
              <span class="train-id">EXP-001</span>
              <span class="train-status">Mumbai Rajdhani</span>
            </div>
            <span class="priority-badge priority-high">HIGH</span>
          </div>
          <div class="train-item" onclick="selectTrain('PAS-102')">
            <div class="train-info">
              <span class="train-id">PAS-102</span>
              <span class="train-status">Local Passenger</span>
            </div>
            <span class="priority-badge priority-medium">MEDIUM</span>
          </div>
          <div class="train-item" onclick="selectTrain('FRT-203')">
            <div class="train-info">
              <span class="train-id">FRT-203</span>
              <span class="train-status">Freight Cargo</span>
            </div>
            <span class="priority-badge priority-low">LOW</span>
          </div>
          <div class="train-item" onclick="selectTrain('EXP-002')">
            <div class="train-info">
              <span class="train-id">EXP-002</span>
              <span class="train-status">Shatabdi Express</span>
            </div>
            <span class="priority-badge priority-high">HIGH</span>
          </div>
          <div class="train-item" onclick="selectTrain('PAS-103')">
            <div class="train-info">
              <span class="train-id">PAS-103</span>
              <span class="train-status">Suburban Local</span>
            </div>
            <span class="priority-badge priority-medium">MEDIUM</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading & Alert -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
  </div>
  <div class="alert" id="alert"></div>

  <script>
    // Global variables
    let trains = [
      { id: 'EXP-001', type: 'express', position: 10, speed: 2, priority: 3, delay: 15, track: 'main' },
      { id: 'PAS-102', type: 'passenger', position: 35, speed: 1.5, priority: 2, delay: 8, track: 'main' },
      { id: 'FRT-203', type: 'freight', position: 60, speed: 1, priority: 1, delay: 5, track: 'secondary' },
      { id: 'EXP-002', type: 'express', position: 25, speed: 2, priority: 3, delay: 10, track: 'main' },
      { id: 'PAS-103', type: 'passenger', position: 50, speed: 1.5, priority: 2, delay: 12, track: 'secondary' }
    ];

    let junctions = [
      { id: 'junction1', position: 25, active: false, mainToSecondary: true },
      { id: 'junction2', position: 50, active: false, mainToSecondary: false },
      { id: 'junction3', position: 75, active: false, mainToSecondary: true }
    ];

    let aiEnabled = false;
    let aiDecisionCount = 0;
    let optimizedPositions = [];
    let isOptimized = false;
    let selectedTrain = null;
    let animationFrameId = null;

    // AI Neural Network Simulation
    class AITrackManager {
      constructor() {
        this.weights = this.initializeWeights();
        this.learningRate = 0.1;
        this.decisionHistory = [];
      }

      initializeWeights() {
        return {
          priority: 0.4,
          speed: 0.3,
          delay: 0.2,
          position: 0.1
        };
      }

      // AI decision making for track switching
      makeTrackDecision(train, allTrains, junctionId) {
        const junction = junctions.find(j => j.id === junctionId);
        if (!junction) return false;

        // Calculate decision factors
        const factors = this.calculateFactors(train, allTrains, junction);
        const decision = this.neuralNetworkDecision(factors);
        
        // Log AI decision
        this.logDecision(train, junction, decision, factors);
        
        return decision.shouldSwitch;
      }

      calculateFactors(train, allTrains, junction) {
        const junctionPos = junction.position;
        
        // Check for conflicts on current track
        const currentTrackConflicts = this.countTrackConflicts(train, allTrains, train.track);
        const alternateTrack = train.track === 'main' ? 'secondary' : 'main';
        const alternateTrackConflicts = this.countTrackConflicts(train, allTrains, alternateTrack);
        
        // Distance to junction
        const distanceToJunction = Math.abs(train.position - junctionPos);
        
        // Calculate congestion ahead
        const congestionAhead = this.calculateCongestionAhead(train, allTrains);
        
        return {
          priorityFactor: train.priority / 3,
          conflictReduction: Math.max(0, currentTrackConflicts - alternateTrackConflicts),
          distanceFactor: Math.max(0, 1 - (distanceToJunction / 50)),
          congestionFactor: congestionAhead / 10,
          delayFactor: train.delay / 20
        };
      }

      neuralNetworkDecision(factors) {
        // Simplified neural network calculation
        const score = 
          factors.priorityFactor * this.weights.priority +
          factors.conflictReduction * 0.4 +
          factors.distanceFactor * this.weights.position +
          factors.congestionFactor * 0.3 +
          factors.delayFactor * this.weights.delay;

        const confidence = Math.min(Math.abs(score), 1);
        const shouldSwitch = score > 0.5;

        return { shouldSwitch, confidence, score };
      }

      countTrackConflicts(train, allTrains, trackType) {
        let conflicts = 0;
        const trainPos = train.position;
        
        allTrains.forEach(otherTrain => {
          if (otherTrain.id !== train.id && otherTrain.track === trackType) {
            const distance = Math.abs(trainPos - otherTrain.position);
            if (distance < 15) conflicts++;
          }
        });
        
        return conflicts;
      }

      calculateCongestionAhead(train, allTrains) {
        let congestion = 0;
        const lookAheadDistance = 30;
        
        allTrains.forEach(otherTrain => {
          if (otherTrain.id !== train.id && 
              otherTrain.track === train.track &&
              otherTrain.position > train.position &&
              otherTrain.position - train.position < lookAheadDistance) {
            congestion++;
          }
        });
        
        return congestion;
      }

      logDecision(train, junction, decision, factors) {
        const timestamp = new Date().toLocaleTimeString();
        const logEntry = {
          timestamp,
          trainId: train.id,
          junctionId: junction.id,
          decision: decision.shouldSwitch ? 'SWITCH' : 'CONTINUE',
          confidence: (decision.confidence * 100).toFixed(1),
          factors
        };
        
        this.decisionHistory.push(logEntry);
        this.updateDecisionLog(logEntry);
        
        aiDecisionCount++;
        document.getElementById('aiDecisions').textContent = aiDecisionCount;
      }

      updateDecisionLog(logEntry) {
        const logContainer = document.getElementById('aiDecisionLog');
        const logItem = document.createElement('div');
        logItem.className = 'ai-log-item';
        logItem.innerHTML = `
          <span class="ai-log-timestamp">[${logEntry.timestamp}]</span> 
          AI Decision: ${logEntry.trainId} â†’ ${logEntry.decision} at ${logEntry.junctionId} 
          (Confidence: ${logEntry.confidence}%)
        `;
        
        logContainer.appendChild(logItem);
        logContainer.scrollTop = logContainer.scrollHeight;
        
        // Keep only last 10 entries
        while (logContainer.children.length > 11) { // +1 for initial message
          logContainer.removeChild(logContainer.children[1]);
        }
      }
    }

    // Initialize AI system
    const aiManager = new AITrackManager();

    // Initialize the system
    window.onload = function() {
      initializeTrains();
      animateTrains();
      updateMetrics();
    };

    // Initialize trains on the track
    function initializeTrains() {
      const trackViz = document.getElementById('trackViz');
      
      trains.forEach(train => {
        const trainElement = document.createElement('div');
        trainElement.className = `train ${train.type}`;
        trainElement.id = train.id;
        trainElement.innerHTML = train.id;
        
        // Position based on track
        const topPosition = train.track === 'main' ? '45%' : '55%';
        trainElement.style.left = `${train.position}%`;
        trainElement.style.top = topPosition;
        trainElement.onclick = () => selectTrain(train.id);
        
        trackViz.appendChild(trainElement);
      });
    }

    // Animate train movement
    function animateTrains() {
      trains.forEach(train => {
        const element = document.getElementById(train.id);
        if (element) {
          //